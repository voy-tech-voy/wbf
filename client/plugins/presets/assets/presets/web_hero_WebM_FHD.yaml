# ============================================================================
# PRESET: Web Hero Video (1920x1080 AV1)
# ============================================================================
# Optimized for: Website backgrounds, Landing page hero loops
# Codec: AV1 (libsvtav1) - High efficiency, modern web standard
# Container: WebM
# ============================================================================

meta:
  id: "web_hero_1080p_av1"
  name: "Hero Video (WebM AV1)"
  category: "web"
  description: "Optimized 1080p background video. Uses AV1 for maximum compression."
  version: "1.1"

style:
  accent_color: "#FF0055"         # "Web Hero" Red/Pink attention color
  icon: "globe"                   # Generic web icon
  glow_strength: "strong"

constraints:
  accepted_types: ["video"]
  accepted_extensions: [".mp4", ".mov", ".mkv", ".avi", ".webm"]
  min_duration: 0.5

parameters:
  # --- GEOMETRY CONTROL ---
  - id: "fill_mode"
    type: "segmented_pill"
    label: "Fill Strategy"
    options: ["Cover", "Contain", "Stretch"]
    default: "Cover"
    tooltip: "Cover: Crops to fill 1920x1080. Contain: Adds black bars. Stretch: Distorts to fit."

  # --- QUALITY CONTROL (CRF) ---
  # AV1 CRF is different from x264. 
  # Range 0-63. 30 is "Visually Lossless" for web. 45 is "Good Background".
  - id: "quality_crf"
    type: "slider"
    label: "Compression Level"
    default: 35
    min_value: 20                 # Archival quality (High bitrate)
    max_value: 50                 # Background/Low bandwidth (Small file)
    tooltip: "Lower = Better Quality. Higher = Smaller File. (Rec: 35 for backgrounds)"

  # --- AUDIO HANDLING ---
  - id: "keep_audio"
    type: "toggle"
    label: "Keep Audio"
    default: false
    tooltip: "Web backgrounds usually should be silent (-an)."

  # --- ENCODING SPEED ---
  # SVT-AV1 Presets: 0 (Slowest) to 13 (Fastest). 
  # 4-6 is the sweet spot for VOD.
  - id: "speed_preset"
    type: "dropdown"
    label: "Encoding Speed"
    options: ["4 (Best Quality)", "6 (Balanced)", "8 (Fast)", "10 (Realtime)"]
    default: "6 (Balanced)"

pipeline:
  - tool: "ffmpeg"
    description: "Convert to AV1 WebM"
    
    # Filename: input_hero_av1_35crf.webm
    filename_suffix: "_hero_av1_{{ quality_crf }}crf"

    command_template: |
      {{ tool_exe }} -y -i "{{ input_path }}"
      
      {# --- 1. GEOMETRY LOGIC (1920x1080 Target) --- #}
      {% if fill_mode == 'Cover' %}
        {# Scale to fill (keeping aspect), then crop center #}
        -vf "scale=1920:1080:force_original_aspect_ratio=increase,crop=1920:1080,setsar=1"
      {% elif fill_mode == 'Contain' %}
        {# Scale to fit (keeping aspect), then pad with black #}
        -vf "scale=1920:1080:force_original_aspect_ratio=decrease,pad=1920:1080:(ow-iw)/2:(oh-ih)/2:black,setsar=1"
      {% else %}
        {# Stretch (ignore aspect ratio) #}
        -vf "scale=1920:1080,setsar=1"
      {% endif %}

      {# --- 2. VIDEO ENCODING (SVT-AV1) --- #}
      -c:v libsvtav1 
      
      {# Extract integer from string "6 (Balanced)" -> 6 #}
      -preset {{ speed_preset.split(' ')[0] }}
      
      -crf {{ quality_crf }}
      
      {# GOP: Keyframe every 4 seconds (approx) for decent seeking in loops #}
      -g 120
      
      {# Pixel Format: Standard 8-bit for web compatibility #}
      -pix_fmt yuv420p

      {# --- 3. AUDIO LOGIC --- #}
      {% if keep_audio %}
        -c:a libopus -b:a 128k
      {% else %}
        -an
      {% endif %}

      {# --- 4. CONTAINER METADATA --- #}
      -f webm
      -row-mt 1 
      
      "{{ output_path }}"